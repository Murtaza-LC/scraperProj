<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Amazon Trending Finder</title>
  <link rel="stylesheet" href="app.css">
  <style>
    :root{
      --bg:#0b0c10; --panel:#11131a; --panel-2:#121521;
      --border:#1f2740; --border-2:#2a3142; --muted:#9aa3b2;
      --text:#e6e6e6; --accent:#3e7bff; --tag:#1a1f31; --tag-border:#2b3552;
      --link:#8ec7ff; --link-hover:#b7dcff;
    }
    *{box-sizing:border-box}
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin:0; background:var(--bg); color:var(--text); }
    header { background:var(--panel); border-bottom:1px solid var(--border); }
    .container { max-width: 1100px; margin: 0 auto; padding: 14px; }
    .row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .stretch { flex:1; }
    .btn { background:var(--accent); color:#fff; padding:9px 14px; border:none; border-radius:8px; cursor:pointer; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .btn-subtle { background:#1a2344; color:#e6eeff; border:1px solid #2a3a6a; }
    .card { background:var(--panel-2); border:1px solid var(--border); border-radius:14px; padding:12px; }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tab { padding:8px 12px; border:1px solid var(--border-2); border-radius:999px; cursor:pointer; background:#141824; }
    .tab.active { background:#23304d; border-color:#3a4a6c; }
    .toolbar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .pill { background:#1a1f31; border:1px solid var(--tag-border); padding:6px 10px; border-radius:999px; cursor:pointer; }
    .muted { color:var(--muted); }
    .head { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .debug-out { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; white-space: pre-wrap; background:#0b0d18; color:#b7cdf3; padding:10px; border-radius:10px; border:1px solid #1c2340; }
    .status { font-size:12px; color:#cbd5e1; }
    .chip { padding:6px 10px; border:1px solid var(--border-2); border-radius:999px; }

    /* accessible links */
    a { color: var(--link); text-decoration: none; }
    a:hover, a:focus { color: var(--link-hover); text-decoration: underline; outline: none; }

    /* FIRST PANE: horizontal rows */
    .hlist { display:flex; flex-direction:column; gap:8px; }
    .hrow {
      display:grid; grid-template-columns: 84px 1fr 300px 140px; gap:12px;
      padding:10px; border:1px solid var(--border); border-radius:12px; background:#0f1220;
      align-items:center;
    }
    @media (max-width: 980px) {
      .hrow { grid-template-columns: 72px 1fr 120px; }
      .hrow .col-tags { display:none; }
    }
    .hrow img { width: 84px; height: 84px; object-fit:contain; background:#0b0d18; border-radius:8px; }
    .hrow .name { font-weight:600; line-height:1.35; }
    .hrow .brand { color:var(--muted); font-size:12px; margin-top:4px; }
    .tags { display:flex; flex-wrap:wrap; gap:6px; }
    .tag { display:inline-block; font-size:12px; padding:3px 6px; border-radius:999px; border:1px solid var(--tag-border); background:var(--tag); }
    .pricebox { text-align:right; }
    .price { font-weight:700; }
    .strike { color:var(--muted); text-decoration:line-through; }
    .open { display:inline-block; margin-top:6px; padding:6px 10px; border-radius:8px; border:1px solid var(--border-2); background:#0f1631; }

    /* SECOND PANE: tables */
    table { width:100%; border-collapse: collapse; }
    th, td { padding:8px; border-bottom:1px solid #21263a; text-align:left; }
    th { position:sticky; top:0; background:var(--panel-2); z-index:1; }
    .tables-grid { display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 980px) { .tables-grid { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
<header>
  <div class="container nav">
    <h1>Amazon Trending Finder</h1>

    <div class="row" style="width:100%">
      <select id="mode">
        <option value="all" selected>Fetch all 4 categories</option>
        <option value="single_mobiles">Mobiles only</option>
        <option value="single_mobile_accessories">Mobile accessories only</option>
        <option value="single_laptops">Laptops only</option>
        <option value="single_laptop_accessories">Laptop accessories only</option>
        <option value="custom">Custom Amazon URL</option>
      </select>

      <input id="amazonUrl" class="stretch" placeholder="Used only in Custom mode (https://www.amazon.in/s?...)" style="display:none"/>

      <label>Pages
        <select id="maxPages">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="3">3</option>
        </select>
      </label>

      <label>Per list
        <input id="perListLimit" type="number" min="6" max="60" step="1" value="16"/>
      </label>

      <label>timeout_ms
        <input id="timeoutMs" type="number" min="3000" step="500" value="12000"/>
      </label>

      <button id="run" class="btn">Fetch</button>
      <button id="exportTabCsv" class="btn btn-subtle" title="Export the visible tab as CSV">Export tab CSV</button>
      <label class="row"><input type="checkbox" id="dbg"> Debug</label>
      <label class="row"><input type="checkbox" id="dbgshot"> Screenshot</label>
    </div>

    <div class="row status" id="statusRow" style="margin-top:6px; display:none"></div>

    <div class="tabs" style="margin-top:8px">
      <span class="tab active" data-cat="mobiles">Mobiles</span>
      <span class="tab" data-cat="mobile_accessories">Mobile Accessories</span>
      <span class="tab" data-cat="laptops">Laptops</span>
      <span class="tab" data-cat="laptop_accessories">Laptop Accessories</span>
      <span class="muted" style="margin-left:auto;">(Click a tab to view that list)</span>
    </div>
  </div>
</header>

<main class="container">
  <!-- First pane -->
  <section class="card" style="margin-bottom:16px">
    <div class="head">
      <strong>Amazon — Trending Lists</strong>
      <span id="totalCount" class="muted"></span>
    </div>
    <div class="toolbar">
      <span class="pill" data-sort="discount">Most discount</span>
      <span class="pill" data-sort="lowest">Lowest price</span>
      <span class="pill" data-sort="highest">Highest price</span>
      <span class="pill" data-sort="reviews">Most reviews</span>
      <span class="pill" data-sort="bought">Most bought (month)</span>
      <input id="search" class="stretch" placeholder="Search in selected tab"/>
    </div>
    <div id="listActive" class="hlist" style="margin-top:10px"></div>
  </section>

  <!-- Second pane -->
  <section class="card" style="margin-bottom:16px">
    <div class="head">
      <strong>Best Sellers (by “bought in past month”, fallback to reviews)</strong>
      <button id="exportInsightsCsv" class="btn btn-subtle">Export insights CSV</button>
    </div>
    <div class="tables-grid">
      <div>
        <div class="head"><strong>Mobile Phones</strong><span id="count_mobiles" class="muted"></span></div>
        <div class="table-wrap"><table id="tbl_mobiles"></table></div>
      </div>
      <div>
        <div class="head"><strong>Phone Accessories</strong><span id="count_mobile_accessories" class="muted"></span></div>
        <div class="table-wrap"><table id="tbl_mobile_accessories"></table></div>
      </div>
      <div>
        <div class="head"><strong>Laptops</strong><span id="count_laptops" class="muted"></span></div>
        <div class="table-wrap"><table id="tbl_laptops"></table></div>
      </div>
      <div>
        <div class="head"><strong>Laptop Accessories</strong><span id="count_laptop_accessories" class="muted"></span></div>
        <div class="table-wrap"><table id="tbl_laptop_accessories"></table></div>
      </div>
    </div>
  </section>

  <pre id="debugOut" class="debug-out" style="display:none;"></pre>
</main>

<script src="app.js"></script>
</body>
</html>
